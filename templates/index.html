<!DOCTYPE html>
<html>
<head>
    <title>Student Registration</title>
    <link rel="stylesheet" type="text/css" href="../static/style.css">
</head>
<body>
<header class="header">
    <div class="header-content">
        <h1>Student Management</h1>
<!--        <img src="{{ url_for('static', filename='background.jpg') }}" alt="Background Image">-->
    </div>
</header>

<nav class="tabs">
    <!-- Accordion Menu for Tabs -->
    <div class="accordion">
        <button class="accordion-button" onclick="toggleAccordion('register-tab')">Register Student</button>
        <button class="accordion-button" onclick="toggleAccordion('student-details-tab')">Student Details</button>
    </div>
</nav>

<div class="tab-content">
    <!-- Register Student Tab -->
    <div class="accordion-tab" id="register-tab" style="display: none;">
        <div class="form-container">
            <h2>Register Student</h2>
            <form method="POST" action="/register" onsubmit="return registerStudent();">
                <div id="success-message" class="success-message"></div>
                <div class="form-group">
                    <label for="first_name">First Name:</label>
                    <input type="text" id="first_name" name="first_name" required>
                </div>

                <div class="form-group">
                    <label for="last_name">Last Name:</label>
                    <input type="text" id="last_name" name="last_name" required>
                </div>

                <div class="form-group">
                    <label for="email">Email Address:</label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="phone_number">Phone Number:</label>
                    <input type="tel" id="phone_number" name="phone_number" required>
                </div>

                <div class="form-group">
                    <label for="dob">Date of Birth:</label>
                    <input type="date" id="dob" name="dob" required>
                </div>

                <div class="form-group">
                    <label for="department">Department:</label>
                    <select id="department" name="department" required>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Electrical Engineering">Electrical Engineering</option>
                        <option value="Electronics and Communication Engineering">Electronics and Communication Engineering</option>
                        <option value="Mechanical Engineering">Mechanical Engineering</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="academic_year">Academic Year:</label>
                    <input type="text" id="academic_year" name="academic_year" required>
                </div>

                <div class="form-group">
                    <input type="submit" value="Register">
                </div>
            </form>
        </div>
    </div>

    <!-- Student Details Tab -->
    <div class="accordion-tab" id="student-details-tab" style="display: none;">
        <div class="form-container">
            <h2>Student Details</h2>
            <form>
                <div class="form-group">
                    <label for="email_to_search">Enter Email to Search:</label>
                    <input type="email" id="email_to_search" name="email_to_search" required>
                </div>

                <div class="form-group">
                    <button type="button" id="fetchStudentDetails" onclick="getStudentDetails()">Fetch Student Details</button>
<!--                    <input type="submit" value="Search">-->
                </div>
            </form>
            {% if student_data %}
            <h3>Student Details:</h3>
            <p>First Name: {{ student_data[0] }}</p>
            <p>Last Name: {{ student_data[1] }}</p>
            <p>Email: {{ student_data[2] }}</p>
            <p>Phone Number: {{ student_data[3] }}</p>
            <p>Date of Birth: {{ student_data[4] }}</p>
            <p>Department: {{ student_data[5] }}</p>
            <p>Academic Year: {{ student_data[6] }}</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Additional Content for Student Details Display -->
<div class="student-details">
    <!-- Student Details... -->
</div>
<script>
    // Function to display a success message and clear form fields
    function displaySuccessMessage(email) {
        const successMessage = document.getElementById('success-message');
        successMessage.innerText = `Student with email ${email} is registered successfully.`;

        // Clear form fields
        document.getElementById('first_name').value = '';
        document.getElementById('last_name').value = '';
        document.getElementById('email').value = '';
        document.getElementById('phone_number').value = '';
        document.getElementById('dob').value = '';
        document.getElementById('department').value = '';
        document.getElementById('academic_year').value = '';

        // Show the success message
        successMessage.style.display = 'block';

        // Hide the success message after 3 seconds
        setTimeout(function () {
            successMessage.style.display = 'none';
            successMessage.innerText = ''; // Clear message text
        }, 3000);
    }

    function toggleAccordion(tabId) {
        const tabs = document.querySelectorAll('.accordion-tab');
        tabs.forEach(tab => {
            if (tab.id === tabId) {
                tab.style.display = 'block';
            } else {
                tab.style.display = 'none';
            }
        });
    }

    function registerStudent() {
        // Get student data from the form
        const first_name = document.getElementById('first_name').value;
        const last_name = document.getElementById('last_name').value;
        const email = document.getElementById('email').value;
        const phone_number = document.getElementById('phone_number').value;
        const dob = document.getElementById('dob').value;
        const department = document.getElementById('department').value;
        const academic_year = document.getElementById('academic_year').value;

        // Check if the email already exists (you can use AJAX or server-side check here)

        // Assuming the registration is successful
        // Add your logic to save student data to a CSV or database here

        // Display a success message and clear form fields
        displaySuccessMessage(email);

        // Return false to prevent the form from actually submitting
        return false;
    }

    function getStudentDetails() {
            const email = document.getElementById('email').value;
            alert(email)
            // Make a GET request to fetch student details
            fetch(`/student-details?email=${encodeURIComponent(email)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        // Display student details in the form
                        document.getElementById('first_name').value = data.first_name;
                        document.getElementById('last_name').value = data.last_name;
                        document.getElementById('phone_number').value = data.phone_number;
                        document.getElementById('dob').value = data.dob;
                        document.getElementById('department').value = data.department;
                        document.getElementById('academic_year').value = data.academic_year;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while fetching student details.');
                });
        }
    // Automatically activate the "Register Student" tab on page load
    window.onload = function() {
        toggleAccordion('register-tab');
        document.querySelector('.accordion-button[data-tab="register-tab"]').classList.add('active');
    };
</script>
</body>
</html>
